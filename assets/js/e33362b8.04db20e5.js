"use strict";(globalThis.webpackChunkapache_website_template=globalThis.webpackChunkapache_website_template||[]).push([[69907],{69623(e,n,t){t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>p,frontMatter:()=>o,metadata:()=>c,toc:()=>h});var l=t(13274),a=t(25709),i=t(38887),s=t(27067);const o={title:"Manage jobs in Gravitino",slug:"/manage-jobs-in-gravitino",date:new Date("2025-08-13T00:00:00.000Z"),keywords:["job","job template","gravitino"],license:"This software is licensed under the Apache License version 2."},r=void 0,c={id:"manage-jobs-in-gravitino",title:"Manage jobs in Gravitino",description:"Introduction",source:"@site/docs/manage-jobs-in-gravitino.md",sourceDirName:".",slug:"/manage-jobs-in-gravitino",permalink:"/docs/next/manage-jobs-in-gravitino",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/gravitino-site/tree/main/docs/manage-jobs-in-gravitino.md",tags:[],version:"current",frontMatter:{title:"Manage jobs in Gravitino",slug:"/manage-jobs-in-gravitino",date:"2025-08-13T00:00:00.000Z",keywords:["job","job template","gravitino"],license:"This software is licensed under the Apache License version 2."},sidebar:"docs",previous:{title:"Manage tags in Gravitino",permalink:"/docs/next/manage-tags-in-gravitino"},next:{title:"Manage policies in Gravitino",permalink:"/docs/next/manage-policies-in-gravitino"}},d={},h=[{value:"Introduction",id:"introduction",level:2},{value:"Job operations",id:"job-operations",level:2},{value:"Register a new job template",id:"register-a-new-job-template",level:3},{value:"Shell job template",id:"shell-job-template",level:4},{value:"Spark job template",id:"spark-job-template",level:4},{value:"List registered job templates",id:"list-registered-job-templates",level:3},{value:"Get a registered job template by name",id:"get-a-registered-job-template-by-name",level:3},{value:"Delete a registered job template by name",id:"delete-a-registered-job-template-by-name",level:3},{value:"Alter a registered job template",id:"alter-a-registered-job-template",level:3},{value:"Run a job based on a job template",id:"run-a-job-based-on-a-job-template",level:3},{value:"List all jobs",id:"list-all-jobs",level:3},{value:"Get a job by job ID",id:"get-a-job-by-job-id",level:3},{value:"Cancel a job by job ID",id:"cancel-a-job-by-job-id",level:3},{value:"Configurations of the job system",id:"configurations-of-the-job-system",level:3},{value:"Configurations for local job executor",id:"configurations-for-local-job-executor",level:4},{value:"Implement a custom job executor",id:"implement-a-custom-job-executor",level:3},{value:"Future work",id:"future-work",level:2}];function j(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,l.jsx)(n.p,{children:"Starting from 1.0.0, Apache Gravitino introduces a new submodule called the job system for users to\nregister, run, and manage jobs. This job system integrates with the existing metadata\nmanagement, enabling users to execute the jobs or actions based on the metadata,\nknown as metadata-driven actions. For instance, this allows users to run jobs for tasks such as\ncompacting Iceberg tables or cleaning old data based on TTL properties."}),"\n",(0,l.jsx)(n.p,{children:"The aim of the job system is to provide a unified way to manage job templates and jobs,\nincluding registering job templates, running jobs based on the job templates, and other related\ntasks. The job system itself is a unified job submitter that allows users to run jobs through it,\nbut it doesn't provide the actual job execution capabilities. Instead, it relies on the\nexisting job executors (schedulers), such as Apache Airflow, Apache Livy, to execute the jobs.\nGravitino's job system provides an extensible way to connect to different job executors."}),"\n",(0,l.jsx)(n.admonition,{type:"note",children:(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"The job system is a new feature introduced in Gravitino 1.0.0, and it is still under\ndevelopment, so some features may not be fully implemented yet."}),"\n",(0,l.jsx)(n.li,{children:"The aim of the job system is not to replace the existing job executors. So, it can only\nsupport running a single job at a time, and it doesn't support job scheduling for now."}),"\n"]})}),"\n",(0,l.jsx)(n.h2,{id:"job-operations",children:"Job operations"}),"\n",(0,l.jsx)(n.h3,{id:"register-a-new-job-template",children:"Register a new job template"}),"\n",(0,l.jsxs)(n.p,{children:["Before running a job, the first step is to register a job template. Currently, Gravitino\nsupports two types of job templates: ",(0,l.jsx)(n.code,{children:"shell"})," and ",(0,l.jsx)(n.code,{children:"spark"})," (we will add more job templates in the\nfuture)."]}),"\n",(0,l.jsx)(n.h4,{id:"shell-job-template",children:"Shell job template"}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"shell"})," job template is used to run scripts, it can be a shell script, or any executable\nscript. The template is defined as follows:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "name": "my_shell_job_template",\n  "jobType": "shell",\n  "comment": "A shell job template to run a script",\n  "executable": "/path/to/my_script.sh",\n  "arguments": ["{{arg1}}", "{{arg2}}"],\n  "environments": {\n    "ENV_VAR1": "{{value1}}",\n    "ENV_VAR2": "{{value2}}"\n  },\n  "customFields": {\n    "field1": "{{value1}}",\n    "field2": "{{value2}}"\n  },\n  "scripts": ["/path/to/script1.sh", "/path/to/script2.sh"]\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Here is a brief description of the fields in the job template:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"name"}),": The name of the job template, must be unique."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"jobType"}),": The type of the job template, use ",(0,l.jsx)(n.code,{children:"shell"})," for a shell job template."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"comment"}),": A comment for the job template, which can be used to describe the job template."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"executable"}),": The path to the executable script, which can be a shell script or any executable script."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"arguments"}),": The arguments to pass to the executable script."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"environments"}),": The environment variables to set when running the jo."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"customFields"}),": Custom fields for the job template, which can be used to store additional\ninformation."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"scripts"}),": A list of scripts that the main executable script can use."]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Please note that:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["The ",(0,l.jsx)(n.code,{children:"executable"})," and ",(0,l.jsx)(n.code,{children:"scripts"})," must be accessible by the Gravitino server. Currently,\nGravitino supports accessing files from the local file system, HTTP(S) URLs, and FTP(S) URLs\n(more distributed file system support will be added in the future). So the ",(0,l.jsx)(n.code,{children:"executable"})," and\n",(0,l.jsx)(n.code,{children:"scripts"})," can be a local file path, or a URL like ",(0,l.jsx)(n.code,{children:"http://example.com/my_script.sh"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["The ",(0,l.jsx)(n.code,{children:"executable"}),", ",(0,l.jsx)(n.code,{children:"arguments"}),", ",(0,l.jsx)(n.code,{children:"environments"}),", ",(0,l.jsx)(n.code,{children:"customFields"})," and ",(0,l.jsx)(n.code,{children:"scripts"})," can use placeholders\nlike ",(0,l.jsx)(n.code,{children:"{{arg1}}"})," and ",(0,l.jsx)(n.code,{children:"{{value1}}"}),", the style is ",(0,l.jsx)(n.code,{children:"{{foo}}"}),". They will be replaced with\nthe actual values when running the job, so you can use them to pass dynamic values to the job template."]}),"\n",(0,l.jsxs)(n.li,{children:["Gravitino will copy the ",(0,l.jsx)(n.code,{children:"executable"})," and ",(0,l.jsx)(n.code,{children:"scripts"})," files to the job working directory\nwhen running the job, so you can use the relative path in the ",(0,l.jsx)(n.code,{children:"executable"})," and ",(0,l.jsx)(n.code,{children:"scripts"})," to\nrefer to other scripts in the job working directory."]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"spark-job-template",children:"Spark job template"}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"spark"})," job template is used to run Spark jobs, it is a Spark application JAR file for now."]}),"\n",(0,l.jsx)(n.p,{children:"The template is defined as follows:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "name": "my_spark_job_template",\n  "jobType": "spark",\n  "comment": "A Spark job template to run a Spark application",\n  "executable": "/path/to/my_spark_app.jar",\n  "arguments": ["{{arg1}}", "{{arg2}}"],\n  "environments": {\n    "ENV_VAR1": "{{value1}}",\n    "ENV_VAR2": "{{value2}}"\n  },\n  "customFields": {\n    "field1": "{{value1}}",\n    "field2": "{{value2}}"\n  },\n  "className": "com.example.MySparkApp",\n  "jars": ["/path/to/dependency1.jar", "/path/to/dependency2.jar"],\n  "files": ["/path/to/file1.txt", "/path/to/file2.txt"],\n  "archives": ["/path/to/archive1.zip", "/path/to/archive2.zip"],\n  "configs": {\n    "spark.executor.memory": "2g",\n    "spark.executor.cores": "2"\n  }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Here is a brief description of the fields in the Spark job template:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"name"}),": The name of the job template, which must be unique."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"jobType"}),": The type of the job template, use ",(0,l.jsx)(n.code,{children:"spark"})," for Spark job template."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"comment"}),": A comment for the job template, which can be used to describe the job template."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"executable"}),": The path to the Spark application JAR file, which can be a local file path or a URL\nwith a supported scheme."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"arguments"}),": The arguments to pass to the Spark application."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"environments"}),": The environment variables to set when running the job."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"customFields"}),": Custom fields for the job template, which can be used to store additional information."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"className"}),": The main class of the Spark application. It is required for Java/Scala Spark\napplication. For PySpark application, this field can be ",(0,l.jsx)(n.code,{children:"null"})," instead."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"jars"}),": A list of JAR files to add to the Spark job classpath, which can be a local file path or a URL\nwith a supported scheme."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"files"}),": A list of files to be copied to the working directory of the Spark job, which can be a local\nfile path or a URL with a supported scheme."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"archives"}),": A list of archives to be extracted to the working directory of the Spark job, which\ncan be a local file path or a URL with a supported scheme."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"configs"}),": A map of Spark configurations to set when running the Spark job."]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Note that:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["The ",(0,l.jsx)(n.code,{children:"executable"}),", ",(0,l.jsx)(n.code,{children:"jars"}),", ",(0,l.jsx)(n.code,{children:"files"}),", and ",(0,l.jsx)(n.code,{children:"archives"})," must be accessible by the Gravitino server.\nCurrently, Gravitino support accessing files from the local file system, HTTP(S) URLs, and\nFTP(S) URLs (more distributed file system supports will be added in the future). So the\n",(0,l.jsx)(n.code,{children:"executable"}),", ",(0,l.jsx)(n.code,{children:"jars"}),", ",(0,l.jsx)(n.code,{children:"files"}),", and ",(0,l.jsx)(n.code,{children:"archives"})," can be a local file path, or a URL like\n",(0,l.jsx)(n.code,{children:"http://example.com/my_spark_app.jar"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["The ",(0,l.jsx)(n.code,{children:"executable"}),", ",(0,l.jsx)(n.code,{children:"arguments"}),", ",(0,l.jsx)(n.code,{children:"environments"}),", ",(0,l.jsx)(n.code,{children:"customFields"}),", ",(0,l.jsx)(n.code,{children:"className"}),", ",(0,l.jsx)(n.code,{children:"jars"}),", ",(0,l.jsx)(n.code,{children:"files"}),",\n",(0,l.jsx)(n.code,{children:"archives"}),", and ",(0,l.jsx)(n.code,{children:"configs"})," can use placeholders like ",(0,l.jsx)(n.code,{children:"{{arg1}}"})," and ",(0,l.jsx)(n.code,{children:"{{value1}}"}),", the style is\n",(0,l.jsx)(n.code,{children:"{{foo}}"}),". They will be replaced with the actual values when running the job, so you can use them\nto pass dynamic values to the job template."]}),"\n",(0,l.jsxs)(n.li,{children:["Gravitino will copy the ",(0,l.jsx)(n.code,{children:"executable"}),", ",(0,l.jsx)(n.code,{children:"jars"}),", ",(0,l.jsx)(n.code,{children:"files"}),", and ",(0,l.jsx)(n.code,{children:"archives"})," files to the job working\ndirectory when running the job, so you can use the relative path in the ",(0,l.jsx)(n.code,{children:"executable"}),", ",(0,l.jsx)(n.code,{children:"jars"}),",\n",(0,l.jsx)(n.code,{children:"files"}),", and ",(0,l.jsx)(n.code,{children:"archives"})," to refer to other files in the job working directory."]}),"\n",(0,l.jsxs)(n.li,{children:["The ",(0,l.jsx)(n.code,{children:"className"})," is required for the Java and Scala Spark job template, it is the main class of\nthe Spark application to be executed. For PySpark job template, this field can be ",(0,l.jsx)(n.code,{children:"null"})," instead."]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"To register a job template, you can use REST API or the Java and Python SDKs. Here is the\nexample to register a shell job template:"}),"\n",(0,l.jsxs)(i.A,{groupId:"language",queryString:!0,children:[(0,l.jsx)(s.default,{value:"shell",label:"Shell",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'curl -X POST -H "Accept: application/vnd.gravitino.v1+json" \\\n     -H "Content-Type: application/json" \\\n     -d \'{\n           "jobTemplate": {\n             "name": "my_shell_job_template",\n             "jobType": "shell",\n             "comment": "A shell job template to run a script",\n             "executable": "/path/to/my_script.sh",\n             "arguments": ["{{arg1}}", "{{arg2}}"],\n             "environments": {\n               "ENV_VAR1": "{{value1}}",\n               "ENV_VAR2": "{{value2}}"\n             },\n             "customFields": {\n               "field1": "{{value1}}",\n               "field2": "{{value2}}"\n             },\n             "scripts": ["/path/to/script1.sh", "/path/to/script2.sh"]\n           }\n        }\' \\\n     http://localhost:8090/api/metalakes/test/jobs/templates\n'})})}),(0,l.jsx)(s.default,{value:"java",label:"Java",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'  ShellJobTemplate jobTemplate = ShellJobTemplate.builder()\n      .name("my_shell_job_template")\n      .comment("A shell job template to run a script")\n      .executable("/path/to/my_script.sh")\n      .arguments(List.of("{{arg1}}", "{{arg2}}"))\n      .environments(Map.of("ENV_VAR1", "{{value1}}", "ENV_VAR2", "{{value2}}"))\n      .customFields(Map.of("field1", "{{value1}}", "field2", "{{value2}}"))\n      .scripts(List.of("/path/to/script1.sh", "/path/to/script2.sh"))\n      .build();\n\n  GravitinoClient client = ...;\n  client.registerJobTemplate(jobTemplate);\n'})})}),(0,l.jsx)(s.default,{value:"python",label:"Python",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'  shell_job_template = (\n      ShellJobTemplate.builder()\n      .with_name("my_shell_job_template")\n      .with_comment("A shell job template to run a script")\n      .with_executable("/path/to/my_script.sh")\n      .with_arguments(["{{arg1}}", "{{arg2}}"])\n      .with_environments({"ENV_VAR1": "{{value1}}", "ENV_VAR2": "{{value2}}"})\n      .with_custom_fields({"field1": "{{value1}}", "field2": "{{value2}}"})\n      .with_scripts(["/path/to/script1.sh", "/path/to/script2.sh"])\n      .build()\n  )\n\n  client = GravitinoClient(...)\n  client.register_job_template(shell_job_template)\n'})})})]}),"\n",(0,l.jsx)(n.h3,{id:"list-registered-job-templates",children:"List registered job templates"}),"\n",(0,l.jsx)(n.p,{children:"You can list all the registered job templates under a metalake by using the REST API or the Java\nand Python SDKs."}),"\n",(0,l.jsxs)(i.A,{groupId:"language",queryString:!0,children:[(0,l.jsx)(s.default,{value:"shell",label:"Shell",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'curl -X GET -H "Accept: application/vnd.gravitino.v1+json" \\\n     http://localhost:8090/api/metalakes/test/jobs/templates\n\nOr using query parameter "details=true" to get more details of the job templates:\n\ncurl -X GET -H "Accept: application/vnd.gravitino.v1+json" \\\n     http://localhost:8090/api/metalakes/test/jobs/templates?details=true\n'})})}),(0,l.jsx)(s.default,{value:"java",label:"Java",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"    GravitinoClient client = ...;\n    List<JobTemplate> detailedJobTemplates = client.listJobTemplates();\n"})})}),(0,l.jsx)(s.default,{value:"python",label:"Python",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"    client = GravitinoClient(...)\n    detailed_job_templates = client.list_job_templates()\n"})})})]}),"\n",(0,l.jsx)(n.h3,{id:"get-a-registered-job-template-by-name",children:"Get a registered job template by name"}),"\n",(0,l.jsx)(n.p,{children:"You can get a registered job template by its name using the REST API or the Java and Python SDKs."}),"\n",(0,l.jsxs)(i.A,{groupId:"language",queryString:!0,children:[(0,l.jsx)(s.default,{value:"shell",label:"Shell",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'curl -X GET -H "Accept: application/vnd.gravitino.v1+json" \\\n     http://localhost:8090/api/metalakes/test/jobs/templates/my_shell_job_template\n'})})}),(0,l.jsx)(s.default,{value:"java",label:"Java",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'    GravitinoClient client = ...;\n    JobTemplate jobTemplate = client.getJobTemplate("my_shell_job_template");\n'})})}),(0,l.jsx)(s.default,{value:"python",label:"Python",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'    client = GravitinoClient(...)\n    job_template = client.get_job_template("my_shell_job_template")\n'})})})]}),"\n",(0,l.jsx)(n.h3,{id:"delete-a-registered-job-template-by-name",children:"Delete a registered job template by name"}),"\n",(0,l.jsx)(n.p,{children:"You can delete a registered job template by its name using the REST API or the Java and Python SDKs."}),"\n",(0,l.jsxs)(n.p,{children:["Note that deleting a job template will also delete all the jobs that are using this job template.\nIf there are queued, started, or to be cancelled jobs that are using this job template, the deletion\nwill fail with an ",(0,l.jsx)(n.code,{children:"InUseException"})," error."]}),"\n",(0,l.jsxs)(i.A,{groupId:"language",queryString:!0,children:[(0,l.jsx)(s.default,{value:"shell",label:"Shell",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'curl -X DELETE -H "Accept: application/vnd.gravitino.v1+json" \\\n     http://localhost:8090/api/metalakes/test/jobs/templates/my_shell_job_template\n'})})}),(0,l.jsx)(s.default,{value:"java",label:"Java",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'    GravitinoClient client = ...;\n    client.deleteJobTemplate("my_shell_job_template");\n'})})}),(0,l.jsx)(s.default,{value:"python",label:"Python",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'    client = GravitinoClient(...)\n    client.delete_job_template("my_shell_job_template")\n'})})})]}),"\n",(0,l.jsx)(n.h3,{id:"alter-a-registered-job-template",children:"Alter a registered job template"}),"\n",(0,l.jsxs)(n.p,{children:["You can alter a registered job template by its name using the REST API or the Java and Python\nSDKs. Gravitino supports altering the ",(0,l.jsx)(n.code,{children:"name"}),", ",(0,l.jsx)(n.code,{children:"comment"})," and ",(0,l.jsx)(n.code,{children:"template"})," fields of the job template."]}),"\n",(0,l.jsxs)(i.A,{groupId:"language",queryString:!0,children:[(0,l.jsx)(s.default,{value:"shell",label:"Shell",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'curl -X PUT -H "Accept: application/vnd.gravitino.v1+json" \\\n    -H "Content-Type: application/json" \\\n    -d \'{\n        "updates": [\n            {\n                "@type": "rename",\n                "newName": "altered_shell_job_template"\n            },\n            {\n                "@type": "comment",\n                "newComment": "An altered shell job template"\n            },\n            {\n                "@type": "updateTemplate",\n                "newTemplate": {\n                    "@type": "shell",\n                    "newExecutable": "/new/path/to/my_script.sh",\n                    "newArguments": ["{{new_arg1}}", "{{new_arg2}}"],\n                    "newEnvironments": {\n                        "NEW_ENV_VAR1": "{{new_value1}}",\n                        "NEW_ENV_VAR2": "{{new_value2}}"\n                    },\n                    "newCustomFields": {\n                        "new_field1": "{{new_value1}}",\n                        "new_field2": "{{new_value2}}"\n                    },\n                    "newScripts": ["/new/path/to/script1.sh", "/new/path/to/script2.sh"]\n                }\n            }\n        ]\n\n    }\' http://localhost:8090/api/metalakes/test/jobs/templates/my_shell_job_template\n'})})}),(0,l.jsx)(s.default,{value:"java",label:"Java",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'    ShellTemplateUpdate newTemplate = ShellTemplateUpdate.builder()\n        .withNewExecutable("/new/path/to/my_script.sh")\n        .withNewArguments(ImmutableList.of("{{new_arg1}}", "{{new_arg2}}"))\n        .withNewEnvironments(ImmutableMap.of("NEW_ENV_VAR1", "{{new_value1}}", "NEW_ENV_VAR2", "{{new_value2}}"))\n        .withNewCustomFields(ImmutableMap.of("new_field1", "{{new_value1}}", "new_field2", "{{new_value2}}"))\n        .withNewScripts(List.of("/new/path/to/script1.sh", "/new/path/to/script2.sh"))\n        .build();\n\n    List<JobTemplateChange> changes = List.of(\n        JobTemplateChange.rename("altered_shell_job_template"),\n        JobTemplateChange.updateComment("An altered shell job template"),\n        JobTemplateChange.updateTemplateUpdateJobTemplate(newTemplate));\n\n    GravitinoClient client = ...;\n    client.alterJobTemplate("my_shell_job_template", changes);\n'})})}),(0,l.jsx)(s.default,{value:"python",label:"Python",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'    new_template = ShellTemplateUpdate(\n        new_executable="/new/path/to/my_script.sh",\n        new_arguments=["{{new_arg1}}", "{{new_arg2}}"],\n        new_environments={"NEW_ENV_VAR1": "{{new_value1}}", "NEW_ENV_VAR2": "{{new_value2}}"},\n        new_custom_fields={"new_field1": "{{new_value1}}", "new_field2": "{{new_value2}}"},\n        new_scripts=["/new/path/to/script1.sh", "/new/path/to/script2.sh"]\n    )\n\n    changes = [\n        JobTemplateChange.rename("altered_shell_job_template"),\n        JobTemplateChange.update_comment("An altered shell job template"),\n        JobTemplateChange.update_template(new_template)\n    ]\n\n    client = GravitinoClient(...)\n    client.alter_job_template("my_shell_job_template", changes)\n'})})})]}),"\n",(0,l.jsx)(n.h3,{id:"run-a-job-based-on-a-job-template",children:"Run a job based on a job template"}),"\n",(0,l.jsx)(n.p,{children:"To run a job based on the registered job template, you can use the REST API or the Java and Python SDKs.\nWhen running a job, you need to provide the job template name and the parameters to replace the\nplaceholders in the job template."}),"\n",(0,l.jsxs)(n.p,{children:["Gravitino leverages the job executor to run the job, so you need to specify the job executor\nthrough configuration ",(0,l.jsx)(n.code,{children:"gravitino.job.executor"}),'. By default, it is set to "local", which means\nthe job will be launched as a process within the same machine that runs the Gravitino server. Note\nthat the local job executor is only for testing. If you want to run the job in a distributed environment,\nyou need to implement your own ',(0,l.jsx)(n.code,{children:"JobExecutor"})," and set the configuration, please see\n",(0,l.jsx)(n.a,{href:"#implement-a-custom-job-executor",children:"Implement a custom job executor"})," section below."]}),"\n",(0,l.jsxs)(i.A,{groupId:"language",queryString:!0,children:[(0,l.jsx)(s.default,{value:"shell",label:"Shell",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'\ncurl -X POST -H "Accept: application/vnd.gravitino.v1+json" \\\n     -H "Content-Type: application/json" \\\n     -d \'{\n           "jobTemplateName": "my_shell_job_template",\n           "jobConf": {\n             "arg1": "value1",\n             "arg2": "value2",\n             "value1": "env_value1",\n             "value2": "env_value2"\n           }\n        }\' \\\n     http://localhost:8090/api/metalakes/test/jobs/runs\n'})})}),(0,l.jsx)(s.default,{value:"java",label:"Java",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'    GravitinoClient client = ...;\n    JobHandle jobHandle = client.runJob("my_shell_job_template", ImmutableMap.of(\n        "arg1", "value1",\n        "arg2", "value2",\n        "value1", "env_value1",\n        "value2", "env_value2"\n    ));\n'})})}),(0,l.jsx)(s.default,{value:"python",label:"Python",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'    client = GravitinoClient(...)\n    job_handle = client.run_job("my_shell_job_template", {\n        "arg1": "value1",\n        "arg2": "value2",\n        "value1": "env_value1",\n        "value2": "env_value2"\n    })\n'})})})]}),"\n",(0,l.jsxs)(n.p,{children:["The returned ",(0,l.jsx)(n.code,{children:"JobHandle"})," contains the job ID and other information about the job. You can use the job ID to\ncheck the job status and cancel the job."]}),"\n",(0,l.jsx)(n.p,{children:"The runJob API will return immediately after the job is submitted to the job executor, and the job will be\nexecuted asynchronously. You can check the job status using the job ID returned by the runJob API."}),"\n",(0,l.jsx)(n.h3,{id:"list-all-jobs",children:"List all jobs"}),"\n",(0,l.jsx)(n.p,{children:"You can list all the jobs under a metalake by using the REST API or the Java and Python SDKs."}),"\n",(0,l.jsxs)(i.A,{groupId:"language",queryString:!0,children:[(0,l.jsx)(s.default,{value:"shell",label:"Shell",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'curl -X GET -H "Accept: application/vnd.gravitino.v1+json" \\\n     http://localhost:8090/api/metalakes/test/jobs/runs\n\nOr using query parameter "jobTemplateName=my_shell_job_template" to filter jobs by job template name:\n\ncurl -X GET -H "Accept: application/vnd.gravitino.v1+json" \\\n     http://localhost:8090/api/metalakes/test/jobs/runs?jobTemplateName=my_shell_job_template\n'})})}),(0,l.jsx)(s.default,{value:"java",label:"Java",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'    GravitinoClient client = ...;\n    List<JobHandle> jobHandles = client.listJobs();\n\n    // To filter jobs by job template name\n    List<JobHandle> filteredJobHandles = client.listJobs("my_shell_job_template");\n\n'})})}),(0,l.jsx)(s.default,{value:"python",label:"Python",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'    client = GravitinoClient(...)\n    job_handles = client.list_jobs()\n\n    # To filter jobs by job template name\n    filtered_job_handles = client.list_jobs(job_template_name="my_shell_job_template")\n'})})})]}),"\n",(0,l.jsx)(n.h3,{id:"get-a-job-by-job-id",children:"Get a job by job ID"}),"\n",(0,l.jsx)(n.p,{children:"You can get a job by its job ID using the REST API or the Java and Python SDKs."}),"\n",(0,l.jsxs)(i.A,{groupId:"language",queryString:!0,children:[(0,l.jsx)(s.default,{value:"shell",label:"Shell",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'curl -X GET -H "Accept: application/vnd.gravitino.v1+json" \\\n     http://localhost:8090/api/metalakes/test/jobs/runs/job-1234567890\n'})})}),(0,l.jsx)(s.default,{value:"java",label:"Java",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'    GravitinoClient client = ...;\n    JobHandle jobHandle = client.getJob("job-1234567890");\n'})})}),(0,l.jsx)(s.default,{value:"python",label:"Python",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'    client = GravitinoClient(...)\n    job_handle = client.get_job("job-1234567890")\n'})})})]}),"\n",(0,l.jsx)(n.h3,{id:"cancel-a-job-by-job-id",children:"Cancel a job by job ID"}),"\n",(0,l.jsx)(n.p,{children:"You can cancel a job by its job ID using the REST API or the Java and Python SDKs."}),"\n",(0,l.jsxs)(n.p,{children:["The job will be cancelled asynchronously, and the job status will be updated to ",(0,l.jsx)(n.code,{children:"CANCELLING"})," first,\nthen to ",(0,l.jsx)(n.code,{children:"CANCELLED"})," when the cancellation is completed. If the job is already in ",(0,l.jsx)(n.code,{children:"SUCCEEDED"}),",\n",(0,l.jsx)(n.code,{children:"FAILED"}),", ",(0,l.jsx)(n.code,{children:"CANCELLING"}),", or ",(0,l.jsx)(n.code,{children:"CANCELLED"})," status, the cancellation will be ignored."]}),"\n",(0,l.jsx)(n.p,{children:"The cancellation will be done by the job executor with the best effort, it relies on the job\nexecutor that supports cancellation. Also, because of the asynchronous nature of the job\ncancellation, the job may not be actually cancelled."}),"\n",(0,l.jsxs)(i.A,{groupId:"language",queryString:!0,children:[(0,l.jsx)(s.default,{value:"shell",label:"Shell",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'curl -X POST -H "Accept: application/vnd.gravitino.v1+json" \\\n     http://localhost:8090/api/metalakes/test/jobs/runs/job-1234567890\n'})})}),(0,l.jsx)(s.default,{value:"java",label:"Java",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'    GravitinoClient client = ...;\n    client.cancelJob("job-1234567890");\n'})})}),(0,l.jsx)(s.default,{value:"python",label:"Python",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'    client = GravitinoClient(...)\n    client.cancel_job("job-1234567890")\n'})})})]}),"\n",(0,l.jsx)(n.h3,{id:"configurations-of-the-job-system",children:"Configurations of the job system"}),"\n",(0,l.jsxs)(n.p,{children:["You can configure the job system through the ",(0,l.jsx)(n.code,{children:"gravitino.conf"})," file. The following are the\ndefault configurations:"]}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Property name"}),(0,l.jsx)(n.th,{children:"Description"}),(0,l.jsx)(n.th,{children:"Default value"}),(0,l.jsx)(n.th,{children:"Required"}),(0,l.jsx)(n.th,{children:"Since Version"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"gravitino.job.stagingDir"})}),(0,l.jsx)(n.td,{children:"Directory for managing the staging files when running jobs"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"/tmp/gravitino/jobs/staging"})}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:"1.0.0"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"gravitino.job.executor"})}),(0,l.jsx)(n.td,{children:"The job executor to use for running jobs"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"local"})}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:"1.0.0"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"gravitino.job.stagingDirKeepTimeInMs"})}),(0,l.jsx)(n.td,{children:"The time in milliseconds to keep the staging directory after the job is completed"}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"604800000"})," (7 days)"]}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:"1.0.0"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"gravitino.job.statusPullIntervalInMs"})}),(0,l.jsx)(n.td,{children:"The interval in milliseconds to pull the job status from the job executor"}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"300000"})," (5 minutes)"]}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:"1.0.0"})]})]})]}),"\n",(0,l.jsx)(n.h4,{id:"configurations-for-local-job-executor",children:"Configurations for local job executor"}),"\n",(0,l.jsx)(n.p,{children:"The local job executor is used for testing and development purposes, it runs the job in the local process.\nThe following are the default configurations for the local job executor:"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Property name"}),(0,l.jsx)(n.th,{children:"Description"}),(0,l.jsx)(n.th,{children:"Default value"}),(0,l.jsx)(n.th,{children:"Required"}),(0,l.jsx)(n.th,{children:"Since Version"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"gravitino.jobExecutor.local.waitingQueueSize"})}),(0,l.jsx)(n.td,{children:"The size of the waiting queue for queued jobs in the local job executor"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"100"})}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:"1.0.0"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"gravitino.jobExecutor.local.maxRunningJobs"})}),(0,l.jsx)(n.td,{children:"The maximum number of running jobs in the local job executor"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"max(1, min(available cores / 2, 10))"})}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:"1.0.0"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"gravitino.jobExecutor.local.jobStatusKeepTimeInMs"})}),(0,l.jsx)(n.td,{children:"The time in milliseconds to keep the job status in the local job executor"}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"3600000"})," (1 hour)"]}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:"1.0.0"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"gravitino.jobExecutor.local.sparkHome"})}),(0,l.jsxs)(n.td,{children:["The home directory of Spark, Gravitino checks this configuration firstly and then ",(0,l.jsx)(n.code,{children:"SPARK_HOME"})," env. Either of them should be set to run Spark job"]}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"None"})}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:"1.0.1"})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"implement-a-custom-job-executor",children:"Implement a custom job executor"}),"\n",(0,l.jsxs)(n.p,{children:["Gravitino's job system is designed to be extensible, allowing you to implement your own job executor\nto run jobs in a distributed environment. You can refer to the interface ",(0,l.jsx)(n.code,{children:"JobExecutor"})," in the\ncode ",(0,l.jsx)(n.a,{href:"https://github.com/apache/gravitino/blob/main/core/src/main/java/org/apache/gravitino/connector/job/JobExecutor.java",children:"here"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["After you implement your own job executor, you need to register it in the Gravitino server by\nusing the ",(0,l.jsx)(n.code,{children:"gravitino.conf"})," file. For example, if you have implemented a job executor named\n",(0,l.jsx)(n.code,{children:"airflow"}),", you need to configure it as follows:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"gravitino.job.executor = airflow\ngravitino.jobExecutor.airflow.class = com.example.MyAirflowJobExecutor\n"})}),"\n",(0,l.jsx)(n.p,{children:"You can also configure the job executor with additional properties, like:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"gravitino.jobExecutor.airflow.host = http://localhost:8080\ngravitino.jobExecutor.airflow.username = myuser\ngravitino.jobExecutor.airflow.password = mypassword\n"})}),"\n",(0,l.jsx)(n.p,{children:"These properties will be passed to the airflow job executor when it is instantiated."}),"\n",(0,l.jsx)(n.h2,{id:"future-work",children:"Future work"}),"\n",(0,l.jsx)(n.p,{children:"The job system is a new feature introduced in Gravitino 1.0.0, and it still needs more work:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Support modification of job templates."}),"\n",(0,l.jsx)(n.li,{children:"Support running Spark jobs (Java and PySpark) based on the Spark job template in the local job\nexecutor."}),"\n",(0,l.jsx)(n.li,{children:"Support more job templates, like Python, SQL, etc."}),"\n",(0,l.jsx)(n.li,{children:"Support more job executors, like Apache Airflow, Apache Livy, etc."}),"\n",(0,l.jsx)(n.li,{children:"Support uploading job template related artifacts to the Gravitino server, also support\ndownloading the artifacts from more distributed file systems like HDFS, S3, etc."}),"\n",(0,l.jsx)(n.li,{children:"Support job scheduling, like running jobs periodically, or based on some events."}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(j,{...e})}):j(e)}},38887(e,n,t){t.d(n,{A:()=>u});var l=t(79474),a=t(13526),i=t(50864),s=t(25591),o=t(64401);const r="tabList_ruUt",c="tabItem_ncTh";var d=t(13274);function h({className:e,block:n,selectedValue:t,selectValue:l,tabValues:s}){const o=[],{blockElementScrollPositionUntilNextRender:r}=(0,i.a_)(),h=e=>{const n=e.currentTarget,a=o.indexOf(n),i=s[a].value;i!==t&&(r(n),l(i))},j=e=>{let n=null;switch(e.key){case"Enter":h(e);break;case"ArrowRight":{const t=o.indexOf(e.currentTarget)+1;n=o[t]??o[0];break}case"ArrowLeft":{const t=o.indexOf(e.currentTarget)-1;n=o[t]??o[o.length-1];break}}n?.focus()};return(0,d.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":n},e),children:s.map(({value:e,label:n,attributes:l})=>(0,d.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>o.push(e),onKeyDown:j,onClick:h,...l,className:(0,a.A)("tabs__item",c,l?.className,{"tabs__item--active":t===e}),children:n??e},e))})}function j({lazy:e,children:n,selectedValue:t}){const a=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=a.find(e=>e.props.value===t);return e?(0,l.cloneElement)(e,{className:"margin-top--md"}):null}return(0,d.jsx)("div",{className:"margin-top--md",children:a.map((e,n)=>(0,l.cloneElement)(e,{key:n,hidden:e.props.value!==t}))})}function p(e){const n=(0,s.u)(e);return(0,d.jsxs)("div",{className:(0,a.A)("tabs-container",r),children:[(0,d.jsx)(h,{...n,...e}),(0,d.jsx)(j,{...n,...e})]})}function u(e){const n=(0,o.default)();return(0,d.jsx)(p,{...e,children:(0,s.v)(e.children)},String(n))}}}]);