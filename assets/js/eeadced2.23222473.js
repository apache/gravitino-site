"use strict";(self.webpackChunkapache_website_template=self.webpackChunkapache_website_template||[]).push([[45272],{93849:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});var s=n(13274),a=n(21943);const l={title:"Apache Gravitino Trino connector - PostgreSQL catalog",slug:"/trino-connector/catalog-postgresql",keyword:"gravitino connector trino",license:"This software is licensed under the Apache License version 2."},r=void 0,i={id:"trino-connector/catalog-postgresql",title:"Apache Gravitino Trino connector - PostgreSQL catalog",description:"The PostgreSQL catalog allows querying and creating tables in an external PostgreSQL database.",source:"@site/versioned_docs/version-1.0.0/trino-connector/catalog-postgresql.md",sourceDirName:"trino-connector",slug:"/trino-connector/catalog-postgresql",permalink:"/docs/1.0.0/trino-connector/catalog-postgresql",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/gravitino-site/tree/main/docs/trino-connector/catalog-postgresql.md",tags:[],version:"1.0.0",frontMatter:{title:"Apache Gravitino Trino connector - PostgreSQL catalog",slug:"/trino-connector/catalog-postgresql",keyword:"gravitino connector trino",license:"This software is licensed under the Apache License version 2."},sidebar:"docs",previous:{title:"MySQL",permalink:"/docs/1.0.0/trino-connector/catalog-mysql"},next:{title:"Supported SQL",permalink:"/docs/1.0.0/trino-connector/sql-support"}},o={},c=[{value:"Requirements",id:"requirements",level:2},{value:"Case sensitivity",id:"case-sensitivity",level:2},{value:"Create table",id:"create-table",level:2},{value:"Alter table",id:"alter-table",level:2},{value:"Select",id:"select",level:2},{value:"Update",id:"update",level:2},{value:"Delete",id:"delete",level:2},{value:"Table and Schema properties",id:"table-and-schema-properties",level:2},{value:"Basic usage examples",id:"basic-usage-examples",level:2},{value:"Creating tables and schemas",id:"creating-tables-and-schemas",level:3},{value:"Writing data",id:"writing-data",level:3},{value:"Querying data",id:"querying-data",level:3},{value:"Modify a table",id:"modify-a-table",level:3},{value:"Drop",id:"drop",level:3}];function d(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"The PostgreSQL catalog allows querying and creating tables in an external PostgreSQL database.\nThis can be used to join data between different systems like PostgreSQL and Hive, or between different PostgreSQL instances."}),"\n",(0,s.jsx)(t.h2,{id:"requirements",children:"Requirements"}),"\n",(0,s.jsx)(t.p,{children:"To connect to PostgreSQL, you need:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"PostgreSQL 10.x or higher."}),"\n",(0,s.jsx)(t.li,{children:"Network access from the Trino coordinator and workers to PostgreSQL. Port 5432 is the default port."}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"case-sensitivity",children:"Case sensitivity"}),"\n",(0,s.jsx)(t.p,{children:"PostgreSQL treats unquoted identifiers as case insensitive.\nFor example, the table name MyTable is equivalent to mytable and MYTABLE."}),"\n",(0,s.jsx)(t.p,{children:'However, if you create a table with quoted identifiers, such as "MyTable", it becomes case sensitive and must be referenced exactly as "MyTable".'}),"\n",(0,s.jsx)(t.p,{children:"When using the Gravitino Trino connector with PostgreSQL, you must use unquoted identifiers to avoid case sensitivity issues.\nOtherwise, schema names, table names or column names containing uppercase letters may not be found."}),"\n",(0,s.jsx)(t.h2,{id:"create-table",children:"Create table"}),"\n",(0,s.jsx)(t.p,{children:"At present, the Apache Gravitino Trino connector only supports basic PostgreSQL table creation statements, which involve fields, null allowances, and comments. However, it does not support advanced features like primary keys, indexes, default values, and auto-increment."}),"\n",(0,s.jsxs)(t.p,{children:["The Gravitino Trino connector does not support ",(0,s.jsx)(t.code,{children:"CREATE TABLE AS SELECT"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"alter-table",children:"Alter table"}),"\n",(0,s.jsx)(t.p,{children:"Gravitino Trino connector supports the following alter table operations:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Rename table"}),"\n",(0,s.jsx)(t.li,{children:"Add a column"}),"\n",(0,s.jsx)(t.li,{children:"Drop a column"}),"\n",(0,s.jsx)(t.li,{children:"Rename a column"}),"\n",(0,s.jsx)(t.li,{children:"Change a column type"}),"\n",(0,s.jsx)(t.li,{children:"Set a table property"}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"select",children:"Select"}),"\n",(0,s.jsx)(t.p,{children:"The Gravitino Trino connector supports most SELECT statements, allowing the execution of queries successfully.\nCurrently, it doesn't support certain query optimizations, such as indexes and pushdowns."}),"\n",(0,s.jsx)(t.h2,{id:"update",children:"Update"}),"\n",(0,s.jsxs)(t.p,{children:["Only ",(0,s.jsx)(t.code,{children:"UPDATE"})," statements with constant assignments and predicates are supported. See also ",(0,s.jsx)(t.a,{href:"https://trino.io/docs/current/connector/postgresql.html#update-limitation",children:"UPDATE limitation"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"delete",children:"Delete"}),"\n",(0,s.jsxs)(t.p,{children:["If the ",(0,s.jsx)(t.code,{children:"WHERE"})," clause is specified, only the matching rows are deleted. Otherwise, all rows from the table are deleted. See also ",(0,s.jsx)(t.a,{href:"https://trino.io/docs/current/connector/postgresql.html#delete-limitation",children:"DELETE limitation"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"table-and-schema-properties",children:"Table and Schema properties"}),"\n",(0,s.jsx)(t.p,{children:"PostgreSQL's tables and schemas cannot support properties."}),"\n",(0,s.jsx)(t.h2,{id:"basic-usage-examples",children:"Basic usage examples"}),"\n",(0,s.jsx)(t.p,{children:"You need to do the following steps before you can use the PostgreSQL catalog in Trino through Gravitino."}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Create a metalake and catalog in Gravitino. Assuming that the metalake name is ",(0,s.jsx)(t.code,{children:"test"})," and the catalog name is ",(0,s.jsx)(t.code,{children:"postgresql_test"}),", then you can use the following code to create them in Gravitino:"]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:'curl -X POST -H "Content-Type: application/json" \\\n-d \'{\n  "name": "test",\n  "comment": "comment",\n  "properties": {}\n}\' http://gravitino-host:8090/api/metalakes\n\ncurl -X POST -H "Content-Type: application/json" \\\n-d \'{\n  "name": "postgresql_test",\n  "type": "RELATIONAL",\n  "comment": "comment",\n  "provider": "jdbc-postgresql",\n  "properties": {\n    "jdbc-url": "jdbc:postgresql://postgresql-host/mydb",\n    "jdbc-user": "<user>",\n    "jdbc-password": "<password>",\n    "jdbc-database": "mydb",\n    "jdbc-driver": "org.postgresql.Driver"\n  }\n}\' http://gravitino-host:8090/api/metalakes/test/catalogs\n'})}),"\n",(0,s.jsxs)(t.p,{children:["For more information about the PostgreSQL catalog, please refer to ",(0,s.jsx)(t.a,{href:"/docs/1.0.0/jdbc-postgresql-catalog",children:"PostgreSQL catalog"}),"."]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Set the value of configuration ",(0,s.jsx)(t.code,{children:"gravitino.metalake"})," to the metalake you have created, named 'test', and start the Trino container."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Use the Trino CLI to connect to the Trino container and run a query."}),"\n",(0,s.jsx)(t.p,{children:"Listing all Gravitino managed catalogs:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"SHOW CATALOGS;\n"})}),"\n",(0,s.jsx)(t.p,{children:"The results are similar to:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:"    Catalog\n----------------\n gravitino\n jmx\n system\n postgresql_test\n(4 rows)\n\nQuery 20231017_082503_00018_6nt3n, FINISHED, 1 node\n"})}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"gravitino"})," catalog is a catalog defined By Trino catalog configuration.\nThe ",(0,s.jsx)(t.code,{children:"postgresql_test"})," catalog is the catalog created by you in Gravitino.\nOther catalogs are regular user-configured Trino catalogs."]}),"\n",(0,s.jsx)(t.h3,{id:"creating-tables-and-schemas",children:"Creating tables and schemas"}),"\n",(0,s.jsxs)(t.p,{children:["Create a new schema named ",(0,s.jsx)(t.code,{children:"database_01"})," in ",(0,s.jsx)(t.code,{children:"postgresql_test"})," catalog."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"CREATE SCHEMA postgresql_test.database_01;\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Create a new table named ",(0,s.jsx)(t.code,{children:"table_01"})," in schema ",(0,s.jsx)(t.code,{children:"postgresql_test.database_01"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"CREATE TABLE postgresql_test.database_01.table_01\n(\nname varchar,\nsalary int\n);\n"})}),"\n",(0,s.jsx)(t.h3,{id:"writing-data",children:"Writing data"}),"\n",(0,s.jsxs)(t.p,{children:["Insert data into the table ",(0,s.jsx)(t.code,{children:"table_01"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"INSERT INTO postgresql_test.database_01.table_01 (name, salary) VALUES ('ice', 12);\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Insert data into the table ",(0,s.jsx)(t.code,{children:"table_01"})," from select:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"INSERT INTO postgresql_test.database_01.table_01 (name, salary) SELECT * FROM postgresql_test.database_01.table_01;\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Update the table ",(0,s.jsx)(t.code,{children:"table_01"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"UPDATE postgresql_test.database_01.table_01 SET name = 'ice_update' WHERE salary = 12;\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Delete the table ",(0,s.jsx)(t.code,{children:"table_01"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"DELETE FROM postgresql_test.database_01.table_01 WHERE salary = 12;\nDELETE FROM postgresql_test.database_01.table_01;\n"})}),"\n",(0,s.jsx)(t.h3,{id:"querying-data",children:"Querying data"}),"\n",(0,s.jsxs)(t.p,{children:["Query the ",(0,s.jsx)(t.code,{children:"table_01"})," table:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"SELECT * FROM postgresql_test.database_01.table_01;\n"})}),"\n",(0,s.jsx)(t.h3,{id:"modify-a-table",children:"Modify a table"}),"\n",(0,s.jsxs)(t.p,{children:["Add a new column ",(0,s.jsx)(t.code,{children:"age"})," to the ",(0,s.jsx)(t.code,{children:"table_01"})," table:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"ALTER TABLE postgresql_test.database_01.table_01 ADD COLUMN age int;\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Drop a column ",(0,s.jsx)(t.code,{children:"age"})," from the ",(0,s.jsx)(t.code,{children:"table_01"})," table:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"ALTER TABLE postgresql_test.database_01.table_01 DROP COLUMN age;\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Rename the ",(0,s.jsx)(t.code,{children:"table_01"})," table to ",(0,s.jsx)(t.code,{children:"table_02"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"ALTER TABLE postgresql_test.database_01.table_01 RENAME TO postgresql_test.database_01.table_02;\n"})}),"\n",(0,s.jsx)(t.h3,{id:"drop",children:"Drop"}),"\n",(0,s.jsx)(t.p,{children:"Drop a schema:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"DROP SCHEMA postgresql_test.database_01;\n"})}),"\n",(0,s.jsx)(t.p,{children:"Drop a table:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"DROP TABLE postgresql_test.database_01.table_01;\n"})})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);